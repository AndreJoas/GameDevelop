<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tabuleiro com Variáveis Específicas</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.16/jspdf.plugin.autotable.min.js"></script>
    <style>
        .cell {
            position: relative;
            /* border: 1px solid #ccc; */
            /* ajuste conforme necessário */
            background-color: rgb(0, 0, 0);
            color: transparent;
            /* cor de fundo da célula */
            border: 1px solid #ccc;
            /* borda das células */
            display: flex;
            justify-content: center;
            width: 35px;
            height: 25px;
            text-align: center;
            line-height: 20px;
            font-size: 14px;
        }
        /* Define a camada preta */
        
        .valaores {
            color: white;
        }
        
        .cell::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: black;
            /* cor da camada preta */
            z-index: 1;
            opacity: 0.8;
            /* ajuste a opacidade conforme necessário */
            pointer-events: none;
            /* permite interações com o conteúdo da célula */
        }
        /* Estilo para células reveladas */
        
        .cell.revealed {
            background-color: transparent;
            /* Remove o fundo preto */
            color: black;
        }
        
        .cell.revealed::before {
            background-color: transparent;
            display: none;
            /* remove a camada preta quando a célula for revelada */
        }
        
        .cell>div {
            position: relative;
            z-index: 1;
            /* garante que o conteúdo da célula fique acima da camada preta */
        }
        
        @media (max-width: 1008px) {
            .buttonvoltar,
            .b1,
            .ger,
            .retangulo1,
            .modal-btn {
                width: 100%;
                box-sizing: border-box;
            }
            .cell {
                width: 25px;
                height: 25px;
                line-height: 25px;
            }
            .botoe {
                max-width: 100%;
                width: 40%;
                border: solid 1px black;
            }
            .b1 {
                width: 22%;
                font-size: 0.6rem;
                height: 50px;
            }
            .deta {
                display: flex;
                justify-content: space-between;
                font-size: 14px;
                color: white;
            }
            .valaores {
                /* border: solid 1px red; */
                width: 17%;
                margin-left: -5rem;
            }
            #agentNameInput {
                width: 100%;
            }
            #pontos {
                font-size: 12px;
                margin-left: -3rem;
            }
        }
        
        @media (max-width: 778px) {
            .buttonvoltar,
            .b1,
            .ger,
            .retangulo1,
            .modal-btn {
                width: 100%;
                box-sizing: border-box;
            }
            .cell {
                width: 25px;
                height: 25px;
                line-height: 25px;
            }
            .botoe {
                max-width: 100%;
                width: 40%;
                border: solid 1px black;
            }
            .b1 {
                width: 22%;
                font-size: 0.6rem;
                height: 50px;
            }
            .deta {
                display: flex;
                justify-content: space-between;
                font-size: 14px;
                color: white;
            }
            .valaores {
                /* border: solid 1px red; */
                width: 17%;
                margin-left: -5rem;
            }
            #agentNameInput {
                width: 100%;
            }
            #pontos {
                font-size: 12px;
                margin-left: -3rem;
            }
            .voltaraomenu,
            .linkvoltar,
            .buttonvoltar,
            .ger {
                font-size: 14px;
            }
            .ger {
                margin-left: -2.5rem;
            }
            #size {
                width: 3rem;
            }
        }
        
        @media (max-width: 590px) {
            .buttonvoltar,
            .b1,
            .ger,
            .retangulo1,
            .modal-btn {
                width: 100%;
                box-sizing: border-box;
            }
            .cell {
                width: 25px;
                height: 25px;
                line-height: 25px;
            }
            .botoe {
                max-width: 100%;
                width: 60%;
                border: solid 1px black;
                margin-left: -1.2rem;
            }
            .b1 {
                width: 22%;
                font-size: 0.6rem;
                height: 50px;
            }
            .deta {
                display: flex;
                justify-content: space-around;
                align-items: center;
                justify-items: center;
                font-size: 14px;
                flex-wrap: wrap-reverse;
                color: white;
                border: solid 1px red;
            }
            .valaores {
                /* border: solid 1px red; */
                width: 47%;
                /* margin-left: 2rem; */
                font-size: 14px;
            }
            #agentNameInput {
                width: 60%;
                height: 23px;
            }
            #pontos {
                margin-left: 1rem;
                font-size: 12px;
                /* margin-left: -3rem; */
            }
            .voltaraomenu,
            .linkvoltar,
            .buttonvoltar,
            .ger {
                font-size: 14px;
            }
            .voltaraomenu {
                display: flex;
                justify-content: space-between;
                max-width: 100%;
                width: 100%;
            }
            h2 {
                max-width: 80%;
                width: 100%;
            }
            .linkvoltar {
                max-width: 20%;
                width: 100%;
            }
            .ger {
                font-size: 10px;
                width: 90%;
                /* margin-left: -2.5rem; */
            }
        }
        
        @media (max-width: 480px) {
            .buttonvoltar,
            body,
            .b1,
            h2,
            .ger,
            .modal-btn {
                font-size: 10px;
            }
            .cell {
                width: 20px;
                height: 20px;
                line-height: 20px;
            }
        }
    </style>
</head>

<body>
    <div class="retangulo1">
        <div class="voltaraomenu">
            <a href="index.html" class="linkvoltar"><button class="buttonvoltar">Voltar ao menu</button></a>
            <h2>Mundo De Wumpus</h2>
        </div>
        <audio id="musica" src="music/"></audio>
        <div class="retangulo2">
            <div class="retangulo3">
                <div class="retangul3">
                    <div class="subret">
                        <label for="size">Tamanho do Tabuleiro:</label>
                        <input type="number" id="size" value="30">
                    </div>
                    <div id="passoAPasso"></div>
                </div>
                <div class="retangul4">
                    <button id="detalhesButton" onclick="mostrarDetalhes()">Mostrar Detalhes</button>
                    <div id="detalhes"></div>
                </div>
            </div>

            <div class="deta">
                <div class="botoe">
                    <button class="b1 cima" onclick="moverAgente('cima')">Mover para Cima</button>
                    <button class="b1 baixo" onclick="moverAgente('baixo')">Mover para Baixo</button>
                    <button class="b1 esquerda" onclick="moverAgente('esquerda')">Mover para Esquerda</button>
                    <button class="b1 direita" onclick="moverAgente('direita')">Mover para Direita</button>
                </div>
                <button class="ger" onclick="gerarTabuleiro()">Gerar Tabuleiro</button>
                <div id="pontos">Pontos do Agente: <span id="pontosAgente">0</span></div>



                <div class="valaores">
                    Nome do Agente: <input value="" type="text" id="agentNameInput" placeholder="Digite o nome do agente">
                </div>



            </div>
        </div>

        <div id="myModal" class="modal">
            <div class="modal-content">
                <p>FIM DE JOGO</p>
                <button id="outroAgenteBtn" class="modal-btn">Escolher outro agente</button>
                <button id="jogarNovamenteBtn" class="modal-btn">Jogar novamente</button>
                <button id="baixarRelatorioBtn" class="modal-btn" onclick="baixarRelatorio()">Baixar Relatório</button>
            </div>
        </div>

        <div id="myModal2" class="modal">
            <div class="modal-content">
                <button id="outroAgenteBtn" class="modal-btn">Escolher outro agente</button>
                <button id="jogarNovamenteBtn" class="modal-btn">Jogar novamente</button>
            </div>
        </div>
    </div>

    <div class="zoom-container" id="tabuleiro">
        <div class="row">
            <div class="cell" data-content=" "></div>
            <div class="cell" data-content=" "></div>
            <!-- Mais células aqui -->
        </div>
    </div>
    <div class="overlay"></div>
    <script>
        var selectedAgent = null;
        var numAgentes = 1;
        var modal = document.getElementById("myModal");
        var modal2 = document.getElementById("myModal2");
        var outroAgenteBtn = document.getElementById("outroAgenteBtn");
        var jogarNovamenteBtn = document.getElementById("jogarNovamenteBtn");
        outroAgenteBtn.addEventListener("click", function() {
            changeAgent();
            modal.style.display = "none";
            location.reload();
        });
        jogarNovamenteBtn.addEventListener("click", function() {
            gerarTabuleiro();
            jogoEmAndamento = true;
            modal.style.display = "none";
            location.reload();
        });

        let memoriaAgente = [];
        let casasVisitadas = [];
        var numPits, numBreezes, numStenches, numGold, numMonsters, numArrows;
        var agentRow = 0,
            agentCol = 0;
        var size = 30; // Defina o tamanho padrão do tabuleiro
        var numGoldPieces = 9;
        var numMonsterPieces = 5;

        let tamanhoTabuleiro = 0
        let passosDados = 0;
        let flechasGastas = 0;
        let matouMonstro = 0;
        let caiuEmPoco = 0;
        let ourosPegos = 0;
        let MortoPorMonstro = 0
        let QuantMonstroKill = 0
        let resposta1 = ''
            // -----------
        let resposta2 = ''
        let resposta3 = ''

        var agentName = '';


        var agentSymbol = 'A';
        var monsterSymbol = 'M';
        var pitSymbol = 'P';
        var breezeSymbol = 'B';
        var stenchSymbol = 'S';
        var flecha = 'F';
        var goldSymbol = 'G';
        var emptySymbol = 'V';
        var retornandoParaCasa = false;
        var jogoEmAndamento = true;

        function changeAgent() {
            selectedAgent = document.getElementById("selectAgent").value;
        }

        function gerarTabuleiro() {


            var agentNameInput = document.getElementById('agentNameInput').value;
            agentName = agentNameInput;
            console.log('Nome do agente atualizado para:', agentName);

            var musicas = [
                'music/Cauldron Boss music [Minecraft Dungeons OST].mp4',
                'music/Full Metal Alchemist Opening 1_ MELISSA GUITAR COVER.mp4',
                'music/Minecraft Dungeons OST- 15 Caravan.mp4',
                'music/Steppe - Minecraft Dungeons_ Flames of the Nether.mp4',
                'music/Undertale OST_ 090 - His Theme.mp4',
                'music/Untold - Minecraft Dungeons- Flames of the Nether.mp4'
            ];
            var indiceMusica = Math.floor(Math.random() * musicas.length);
            var urlMusica = musicas[indiceMusica];
            var audio = document.getElementById('musica');
            // Pausa a música, se estiver tocando
            if (!audio.paused) {
                audio.pause();
            }
            audio.src = urlMusica;
            audio.currentTime = 0; // Isso reinicia a música para o início
            audio.play();

            var size = parseInt(document.getElementById('size').value);
            var tabuleiro = document.getElementById('tabuleiro');
            var detalhesButton = document.getElementById('detalhesButton');
            var detalhesDiv = document.getElementById('detalhes');
            var passoAPassoDiv = document.getElementById('passoAPasso');
            tabuleiro.innerHTML = '';
            detalhesDiv.innerHTML = '';
            passoAPassoDiv.innerHTML = '';

            // Inicializando as variáveis
            numPits = 0;
            numBreezes = 0;
            numStenches = 0;
            numGold = 0;
            numMonsters = 0;
            numArrows = 40;
            agentPoints = 0; // Definindo os pontos de vida iniciais do agente
            // Atualizar o elemento HTML para exibir os pontos do agente
            document.getElementById('pontosAgente').textContent = agentPoints;
            // Limpar o array de casas visitadas
            memoriaAgente = []

            // Criando o tabuleiro com células e atribuindo pesos conforme solicitado
            for (var i = 0; i < size; i++) {
                var row = document.createElement('div');
                row.classList.add('row');
                for (var j = 0; j < size; j++) {
                    var cell = document.createElement('div');
                    cell.classList.add('cell');
                    cell.dataset.content = '';
                    // Atribuindo os pesos conforme solicitado
                    var randomWeight = Math.random();
                    if (randomWeight < 0.3) {
                        cell.dataset.weight = 0.3; // Casa com brisa (B)
                    } else if (randomWeight < 0.6) {
                        cell.dataset.weight = 0.3; // Casa com fedor (S)
                    } else {
                        cell.dataset.weight = 0.1; // Casa vazia (V)
                    }
                    row.appendChild(cell);
                    memoriaAgente = [];
                    for (let i = 0; i < size; i++) {
                        memoriaAgente[i] = [];
                        for (let j = 0; j < size; j++) {
                            // Inicializa cada célula na memória do agente com percepção vazia, peso inicial e não visitada
                            memoriaAgente[i][j] = {
                                percepcao: '',
                                peso: 0.1, // Peso padrão para células não visitadas ou sem percepção específica
                                visitado: false
                            };
                        }
                    }
                }
                tabuleiro.appendChild(row);
            }

            // Posicionando o agente
            var agentRow = 0;
            var agentCol = 0;
            var agentCell = tabuleiro.querySelector(`.row:nth-child(${agentRow + 1}) .cell:nth-child(${agentCol + 1})`);
            agentCell.dataset.content = agentSymbol + emptySymbol;
            agentCell.textContent = agentSymbol;
            // Adiciona a posição inicial do agente ao array de casas visitadas
            casasVisitadas.push({
                linha: agentRow,
                coluna: agentCol
            });

            // Colocando o monstro em uma posição aleatória, diferente da posição do agente
            // Colocando múltiplos pedaços de ouro em posições aleatórias
            for (var g = 0; g < numGoldPieces; g++) {
                var goldRow, goldCol;
                do {
                    goldRow = Math.floor(Math.random() * size);
                    goldCol = Math.floor(Math.random() * size);
                } while ((goldRow === agentRow && goldCol === agentCol) || tabuleiro.querySelector(`.row:nth-child(${goldRow + 1}) .cell:nth-child(${goldCol + 1})`).dataset.content.includes(goldSymbol));
                var goldCell = tabuleiro.querySelector(`.row:nth-child(${goldRow + 1}) .cell:nth-child(${goldCol + 1})`);
                goldCell.dataset.content = goldSymbol;
                goldCell.textContent = goldSymbol;
                numGold++;
            }

            // Calculando o número de poços
            var maxPits = size - 1;
            // Gerando os poços e as brisas
            for (var k = 0; k < maxPits; k++) {
                var pitRow, pitCol;
                do {
                    pitRow = Math.floor(Math.random() * size);
                    pitCol = Math.floor(Math.random() * size);
                } while ((pitRow === agentRow && pitCol === agentCol));
                var pitCell = tabuleiro.querySelector(`.row:nth-child(${pitRow + 1}) .cell:nth-child(${pitCol + 1})`);
                pitCell.dataset.content = pitSymbol;
                pitCell.textContent = pitSymbol;
                numPits++;
                // Colocando brisas ao redor do poço
                if (pitRow > 0) {
                    var topCell = tabuleiro.querySelector(`.row:nth-child(${pitRow}) .cell:nth-child(${pitCol + 1})`);
                    if (!topCell.dataset.content.includes(pitSymbol)) {
                        topCell.dataset.content += breezeSymbol;
                        topCell.textContent = topCell.dataset.content;
                        numBreezes++;
                    }
                }
                if (pitRow < size - 1) {
                    var bottomCell = tabuleiro.querySelector(`.row:nth-child(${pitRow + 2}) .cell:nth-child(${pitCol + 1})`);
                    if (!bottomCell.dataset.content.includes(pitSymbol)) {
                        bottomCell.dataset.content += breezeSymbol;
                        bottomCell.textContent = bottomCell.dataset.content;
                        numBreezes++;
                    }
                }
                if (pitCol > 0) {
                    var leftCell = tabuleiro.querySelector(`.row:nth-child(${pitRow + 1}) .cell:nth-child(${pitCol})`);
                    if (!leftCell.dataset.content.includes(pitSymbol)) {
                        leftCell.dataset.content += breezeSymbol;
                        leftCell.textContent = leftCell.dataset.content;
                        numBreezes++;
                    }
                }
                if (pitCol < size - 1) {
                    var rightCell = tabuleiro.querySelector(`.row:nth-child(${pitRow + 1}) .cell:nth-child(${pitCol + 2})`);
                    if (!rightCell.dataset.content.includes(pitSymbol)) {
                        rightCell.dataset.content += breezeSymbol;
                        rightCell.textContent = rightCell.dataset.content;
                        numBreezes++;
                    }
                }
            }
            for (var m = 0; m < numMonsterPieces; m++) {
                var monsterRow, monsterCol;
                do {
                    monsterRow = Math.floor(Math.random() * size);
                    monsterCol = Math.floor(Math.random() * size);
                } while ((monsterRow === agentRow && monsterCol === agentCol));
                var monsterCell = tabuleiro.querySelector(`.row:nth-child(${monsterRow + 1}) .cell:nth-child(${monsterCol + 1})`);
                monsterCell.dataset.content = monsterSymbol;
                monsterCell.textContent = monsterSymbol;
                numMonsters++;
                // Adicionando fedor ao redor do monstro
                if (monsterRow > 0) {
                    var monsterTopCell = tabuleiro.querySelector(`.row:nth-child(${monsterRow}) .cell:nth-child(${monsterCol + 1})`);
                    if (!monsterTopCell.dataset.content.includes(monsterSymbol)) {
                        monsterTopCell.dataset.content += stenchSymbol;
                        monsterTopCell.textContent = monsterTopCell.dataset.content;
                        numStenches++;
                    }
                }
                if (monsterRow < size - 1) {
                    var monsterBottomCell = tabuleiro.querySelector(`.row:nth-child(${monsterRow + 2}) .cell:nth-child(${monsterCol + 1})`);
                    if (!monsterBottomCell.dataset.content.includes(monsterSymbol)) {
                        monsterBottomCell.dataset.content += stenchSymbol;
                        monsterBottomCell.textContent = monsterBottomCell.dataset.content;
                        numStenches++;
                    }
                }
                if (monsterCol > 0) {
                    var monsterLeftCell = tabuleiro.querySelector(`.row:nth-child(${monsterRow + 1}) .cell:nth-child(${monsterCol})`);
                    if (!monsterLeftCell.dataset.content.includes(monsterSymbol)) {
                        monsterLeftCell.dataset.content += stenchSymbol
                        monsterLeftCell.textContent = monsterLeftCell.dataset.content;
                        numStenches++;
                    }
                }
                if (monsterCol < size - 1) {
                    var monsterRightCell = tabuleiro.querySelector(`.row:nth-child(${monsterRow + 1}) .cell:nth-child(${monsterCol + 2})`);
                    if (!monsterRightCell.dataset.content.includes(monsterSymbol)) {
                        monsterRightCell.dataset.content += stenchSymbol;
                        monsterRightCell.textContent = monsterRightCell.dataset.content;
                        numStenches++;
                    }
                }
            }

            // Preenchendo as células vazias com o símbolo de célula vazia
            var emptyCells = tabuleiro.querySelectorAll('.cell');
            emptyCells.forEach(cell => {
                if (cell.textContent === '') {
                    cell.dataset.content = emptySymbol;
                    cell.textContent = emptySymbol;
                }
            });

            // Atualiza os detalhes do tabuleiro
            // detalhesDiv.innerHTML = `
            // <p>Número de poços: ${numPits}</p>
            // <p>Número de brisas: ${numBreezes}</p>
            // <p>Número de monstros: ${numMonsters}</p>
            // <p>Número de fedores: ${numStenches}</p>
            // <p>Número de peças de ouro: ${numGold}</p>
            // `;

            // Configuração do botão de detalhes
            detalhesButton.addEventListener('click', function() {
                detalhesDiv.style.display = detalhesDiv.style.display === 'none' ? 'block' : 'none';
            });

            // Atualiza o passo a passo
            passoAPassoDiv.innerHTML = '<p>Passo a passo:</p>';

            // Atualiza o estado inicial do tabuleiro e do agente


        }

        function atualizarPosicaoAgente() {
            var cells = tabuleiro.querySelectorAll('.cell');

            // Limpa o conteúdo de todas as células que contêm o símbolo do agente e a flecha
            cells.forEach(cell => {
                if (cell.textContent.includes(agentSymbol)) {
                    cell.textContent = cell.textContent.replace(agentSymbol, '');
                }
                if (cell.textContent.includes(flecha)) {
                    cell.textContent = cell.textContent.replace(flecha, '');
                }
            });

            // Define a nova célula onde o agente vai estar
            var agentCell = tabuleiro.querySelector(`.row:nth-child(${agentRow + 1}) .cell:nth-child(${agentCol + 1})`);

            // Atualiza o conteúdo da nova célula com o símbolo do agente e a flecha
            agentCell.textContent = agentSymbol;

            // Adiciona a flecha ao conteúdo da nova célula, se necessário
            if (retornandoParaCasa) {
                agentCell.textContent += flecha;
            }

            // Atualiza a exibição dos pontos do agente na tela
            var pontosAgenteSpan = document.getElementById('pontosAgente');
            if (pontosAgenteSpan) {
                pontosAgenteSpan.textContent = 'Pontos: ' + agentPoints;
            }
        }

        function mostrarDetalhes() {
            var detalhesDiv = document.getElementById('detalhes');
            detalhesDiv.innerHTML = `
     
        <div class="det po"><p>Número de Poços: ${numPits}</p></div>
        <div class="det br"><p>Número de Brisas: ${numBreezes}</p></div>
        <div class="det fr"><p>Número de Fedor: ${numStenches}</p></div>
        <div class="det go"><p>Número de Ouro: ${numGold}</p></div>
        <div class="det mo"><p>Número de Monstros: ${numMonsters}</p></div>
        <div class="det fl"><p>Número de Flechas: ${numArrows}</p></div>
    `;
            detalhesDiv.style.display = 'block';
            console.log(`Pontos: ${agentPoints}, Passos dados: ${passosDados}, Flechas gastas: ${flechasGastas}, Matou monstro: ${matouMonstro}, Caiu em poço: ${caiuEmPoco}, Ouros pegos: ${ourosPegos}`);
        }

        function fimDeJogo() {
            if (selectedAgent === 'V3') {
                memoriaAgente = [];
            }
            jogoEmAndamento = false; // Define o jogo como não em andamento
            modal.style.display = "block"; // Mostra o modal
            // Mostra a matriz atualizada no console
        }
        var flechaAtirada = false; // Variável para controlar se a flecha já foi atirada
        function atirarFlecha() {
            // Remover o event listener temporariamente para evitar múltiplos disparos de flecha
            document.removeEventListener('keydown', handleKeyDown);
            var size = parseInt(document.getElementById('size').value);
            var tabuleiro = document.getElementById('tabuleiro');
            var pontosAgenteSpan = document.getElementById('pontosAgente'); // Elemento span para exibir os pontos do agente
            // Atualizar a exibição dos pontos do agente na tela
            if (pontosAgenteSpan) {
                pontosAgenteSpan.textContent = agentPoints;
            }
            // Atualizar o número de flechas na seção de detalhes
            var detalhesElemento = document.getElementById('detalhes');
            if (detalhesElemento) {
                var pElement = detalhesElemento.querySelector('p:nth-child(6)');
                if (pElement) {
                    pElement.textContent = `Número de Flechas: ${numArrows}`;
                }
            }
            var agentCell = tabuleiro.querySelector(`.row:nth-child(${agentRow + 1}) .cell:nth-child(${agentCol + 1})`);
            var targetRow = agentRow;
            var targetCol = agentCol;
            // Verificar se o agente está no início do tabuleiro e sente mal cheiro
            if (agentRow === 0 && agentCol === 0 && (agentCell.dataset.content === 'AVS' || agentCell.dataset.content === 'AVBS' || agentCell.dataset.content === 'AVSB')) {
                // Atirar na célula (1,1) se sentir mal cheiro no início do tabuleiro
                targetRow = 0;
                targetCol = 0;
            } else {
                // Escolher uma direção aleatória para atirar a flecha
                var randomDirection = Math.floor(Math.random() * 4); // 0 para cima, 1 para baixo, 2 para esquerda, 3 para direita
                // Determinar a posição alvo com base na direção aleatória
                switch (randomDirection) {
                    case 0: // Cima
                        targetRow--;
                        break;
                    case 1: // Baixo
                        targetRow++;
                        break;
                    case 2: // Esquerda
                        targetCol--;
                        break;
                    case 3: // Direita
                        targetCol++;
                        break;
                }
            }
            // Verificar se a posição alvo está dentro dos limites do tabuleiro
            if (targetRow >= 0 && targetRow < size && targetCol >= 0 && targetCol < size) {
                // Encontrar a célula alvo
                var targetCell = tabuleiro.querySelector(`.row:nth-child(${targetRow + 1}) .cell:nth-child(${targetCol + 1})`);
                numArrows--;
                flechasGastas += 1
                mostrarDetalhes();
                if (targetCell) {
                    // Verificar se o alvo contém o símbolo do monstro
                    if (targetCell.dataset.content.includes(monsterSymbol)) {
                        // Remover o monstro do tabuleiro
                        targetCell.dataset.content = targetCell.dataset.content.replace(monsterSymbol, emptySymbol);
                        targetCell.textContent = targetCell.textContent.replace(monsterSymbol, emptySymbol);
                        // Atualizar o número de monstros
                        numMonsters--;
                        matouMonstro += 1
                        QuantMonstroKill += 1
                            // Exibir mensagem de sucesso
                        alert('UAU!! BOA PONTARIA!!! Você atingiu o monstro!');
                        agentPoints += 1000;
                        mostrarDetalhes();
                        return
                    } else {
                        // Exibir mensagem de que a flecha não atingiu o monstro ou a borda do tabuleiro
                        alert('VISH! MELHORE A PONTARIA!! Você atirou uma flecha, mas não acertou o monstro!');
                        return
                    }
                } else {
                    // Exibir mensagem se a célula alvo estiver fora dos limites
                    alert('Flecha atirada fora do tabuleiro!');
                    return
                }
            } else {
                numArrows--;
                // Exibir mensagem se a célula alvo estiver fora dos limites
                alert('Flecha atirada fora do tabuleiro!');
                return
            }
            // Atualizar a exibição dos pontos do agente na tela
            if (pontosAgenteSpan) {
                pontosAgenteSpan.textContent = agentPoints;
            }
            // Permitir novamente o disparo da flecha após um curto período de tempo
            setTimeout(function() {
                flechaAtirada = false;
                document.addEventListener('keydown', handleKeyDown);
            }, 1000);
            mostrarDetalhes();
        }

        function handleKeyDown(event) {
            if (event.key === 'f' || event.key === 'F') {
                if (!flechaAtirada) {
                    flechaAtirada = true;
                }
            } else {
                // Outras teclas para movimentação do agente
                moverAgente(event.key);
            }
        }

        function revelarCelula(celula) {
            if (!celula) {
                console.error('Célula não encontrada:', celula);
                return; // Não faz nada se a célula for inválida
            }
            celula.classList.add('revealed');
        }


        //agente numero V1 (INICIANTE)
        function moverAgente(direcao) {
            if (!jogoEmAndamento) {
                return; // Não move o agente se o jogo não estiver em andamento
            }

            console.log('Direção recebida:', direcao); // Verifique se a direção está sendo recebida

            var size = parseInt(document.getElementById('size').value);
            var tabuleiro = document.getElementById('tabuleiro');
            var currentCell = tabuleiro.querySelector(`.row:nth-child(${agentRow + 1}) .cell:nth-child(${agentCol + 1})`);
            currentCell.textContent = currentCell.textContent.replace(agentSymbol, '').replace(flecha, '');
            console.log('Movendo agente de forma aleatória.');
            // Escolher aleatoriamente uma direção (cima, baixo, esquerda, direita)
            // Atualizar a posição do agente de acordo com a direção fornecida
            switch (direcao) {
                case 'direita':
                    if (agentRow > 0) agentRow--;
                    break;
                case 'esquerda':
                    if (agentRow < size - 1) agentRow++;
                    break;
                case 'cima':
                    if (agentCol > 0) agentCol--;
                    break;
                case 'baixo':
                    if (agentCol < size - 1) agentCol++;
                    break;
                default:
                    console.error('Direção inválida:', direcao);
                    return; // Não faz nada se a direção for inválida
            }

            mostrarDetalhes();
            agentPoints--;
            passosDados++;
            // Atualizar a exibição dos pontos do agente na tela
            var pontosAgenteSpan = document.getElementById('pontosAgente');
            if (pontosAgenteSpan) {
                pontosAgenteSpan.textContent = agentPoints;
            }



            // Verificar o conteúdo da nova célula após mover o agente
            var newAgentCell = tabuleiro.querySelector(`.row:nth-child(${agentRow + 1}) .cell:nth-child(${agentCol + 1})`);
            // Revelar a célula
            revelarCelula(newAgentCell);
            switch (newAgentCell.dataset.content) {
                case stenchSymbol:
                case 'AFVS':
                    mensagem = '- Você sentiu um mau cheiro. Pressione "F" para atirar uma flecha.';
                    var randomShoot = Math.random() < 0.5; // 50% de chance de atirar
                    if (randomShoot) {
                        atirarFlecha();
                    }
                    break;
                case goldSymbol:
                    mensagem = '- Você encontrou o ouro, está na hora de ir.';
                    // Remover o ouro da célula
                    newAgentCell.dataset.content = newAgentCell.dataset.content.replace(goldSymbol, emptySymbol);
                    newAgentCell.textContent = newAgentCell.textContent.replace(goldSymbol, emptySymbol);
                    numGold--; // Decrementar o número de ouro
                    ourosPegos += 1
                        // Adicionar 1000 pontos ao agente
                    agentPoints += 1000;
                    // Atualizar a exibição dos pontos do agente na tela
                    pontosAgenteSpan.textContent = agentPoints;
                    break;
                case pitSymbol:
                    mensagem = '';
                    caiuEmPoco += 1;
                    alert('Você caiu em um poço, cuidado!');
                    fimDeJogo(); // Chama a função fimDeJogo se os pontos de vida acabarem
                    break;
                case monsterSymbol:
                    mensagem = '';
                    MortoPorMonstro += 1
                    alert('Você não foi sagaz, o monstro lhe achou!');
                    fimDeJogo(); // Chama a função fimDeJogo se os pontos de vida acabarem
                    break;
                case 'MB':
                    MortoPorMonstro += 1
                    alert('Você sentiu uma brisa, porém não prestou atenção e o monstro lhe achou!');
                    fimDeJogo(); // Chama a função fimDeJogo se os pontos de vida acabarem
                    break;
                case 'B':
                    mensagem = '- Você sentiu uma brisa. Há poços por perto.';
                    break;
                case 'BB':
                    mensagem = '- Você sentiu uma brisa forte. Há poços muito próximos.';
                    break;
                case 'AVB':
                    mensagem = '- Você sentiu uma brisa forte. Há poços muito próximos.';
                    break;
                case 'AVS':
                    mensagem = '-  Você sentiu um mal cheiro. Fique alerta, pode haver monstro ou poços ao redor!';
                    break;
                case 'BS':
                case 'SB':
                case 'BBS':
                case 'BBBS':
                case 'AFVBS':
                case 'AFVBBS':
                    mensagem = '- Você sentiu uma brisa forte e um mal cheiro. Fique alerta, pode haver monstro ou poços ao redor!';
                    var randomShoot = Math.random() < 0.5; // 50% de chance de atirar
                    if (randomShoot) {
                        atirarFlecha();
                    }
                    break;
                case 'PS':
                    mensagem = '';
                    caiuEmPoco += 1;
                    alert(' Você sentiu um mal cheiro. Porém não tomou cuidado e caiu em um poço!');
                    fimDeJogo(); // Chama a função fimDeJogo se os pontos de vida acabarem
                    break;
                case 'PB':
                    mensagem = '';
                    caiuEmPoco += 1;
                    alert(' Você sentiu uma brisa forte. Porém não tomou cuidado e caiu em um poço!');
                    fimDeJogo(); // Chama a função fimDeJogo se os pontos de vida acabarem
                    break;
                case 'GS':
                    mensagem = '- Você encontrou o ouro, mas sentiu um mal cheiro. Fique alerta, pode haver monstro ao redor!';
                    var randomShoot = Math.random() < 0.5; // 50% de chance de atirar
                    if (randomShoot) {
                        atirarFlecha();
                    }
                    // Remover o ouro da célula
                    newAgentCell.dataset.content = newAgentCell.dataset.content.replace(goldSymbol, emptySymbol);
                    newAgentCell.textContent = newAgentCell.textContent.replace(goldSymbol, emptySymbol);
                    numGold--; // Decrementar o número de ouro
                    ourosPegos += 1
                        // Adicionar 1000 pontos ao agente
                    agentPoints += 1000;
                    // Atualizar a exibição dos pontos do agente na tela
                    pontosAgenteSpan.textContent = agentPoints;
                    break;
                case 'GB':
                case 'GBB':
                case 'GBBB':
                    mensagem = '- Você encontrou o ouro, mas sentiu uma brisa forte. Fique alerta, pode haver poços muito próximos!';
                    // Remover o ouro da célula
                    newAgentCell.dataset.content = newAgentCell.dataset.content.replace(goldSymbol, emptySymbol);
                    newAgentCell.textContent = newAgentCell.textContent.replace(goldSymbol, emptySymbol);
                    numGold--; // Decrementar o número de ouro
                    ourosPegos += 1
                        // Adicionar 1000 pontos ao agente
                    agentPoints += 1000;
                    // Atualizar a exibição dos pontos do agente na tela
                    pontosAgenteSpan.textContent = agentPoints;
                    break;
                case 'GBS':
                case 'GBBS':
                case 'GBBBS':
                    mensagem = '- Você encontrou o ouro, mas sentiu uma brisa forte e sentiu um mal cheiro.. Fique alerta, pode haver poços muito próximos e o monstro a espreitar.';
                    var randomShoot = Math.random() < 0.5; // 50% de chance de atirar
                    if (randomShoot) {
                        atirarFlecha();
                    }
                    // Remover o ouro da célula
                    newAgentCell.dataset.content = newAgentCell.dataset.content.replace(goldSymbol, emptySymbol);
                    newAgentCell.textContent = newAgentCell.textContent.replace(goldSymbol, emptySymbol);
                    numGold--; // Decrementar o número de ouro
                    ourosPegos += 1
                        // Adicionar 1000 pontos ao agente
                    agentPoints += 1000;
                    // Atualizar a exibição dos pontos do agente na tela
                    pontosAgenteSpan.textContent = agentPoints;
                    break;
                case 'BBB':
                    mensagem = '- Você sentiu uma brisa intensa. Há poços extremamente próximos.';
                    break;
                case 'VB':
                    mensagem = '- Você sentu uma brisa intensa. Há poços extremamente próximos.';
                    break;
                case 'VBB':
                    mensagem = '- Você sentiu uma brisa intensa. Há poços extremamente próximos.';
                    break;
                default:
                    mensagem = '- Você entrou em uma casa vazia.';
                    break;
            }
            // Adiciona a mensagem à lista de detalhes
            var passoAPasso = document.getElementById('passoAPasso');
            var listItem = document.createElement('li');
            listItem.textContent = mensagem;
            passoAPasso.appendChild(listItem);
            var newCell = tabuleiro.querySelector(`.row:nth-child(${agentRow + 1}) .cell:nth-child(${agentCol + 1})`);
            newCell.textContent = agentSymbol + flecha + newCell.textContent;
            var mensagens = passoAPasso.querySelectorAll('li');
            var mensagemPegouOuro = false;
            mensagens.forEach(function(msg) {
                if (msg.textContent.includes('Você encontrou o ouro') ||
                    msg.textContent.includes('Você encontrou o ouro, mas sentiu uma brisa forte e sentiu um mal cheiro.. Fique alerta, pode haver poços muito próximos e o monstro a espreitar.') ||
                    msg.textContent.includes('Você encontrou o ouro, mas sentiu uma brisa forte. Fique alerta, pode haver poços muito próximos!') ||
                    msg.textContent.includes('Você encontrou o ouro, mas sentiu um mal cheiro. Fique alerta, pode haver monstro ao redor!')) {
                    mensagemPegouOuro = true;
                }
            });
            if (agentRow === 0 && agentCol === 0 && mensagemPegouOuro) {
                alert("Você conseguiu! Que tal aumentar o tamanho do tabuleiro para um desafio maior?");
                fimDeJogo();
            }
        }

        function fimDeJogo() {
            if (selectedAgent === 'V3') {
                memoriaAgente = [];
            }
            jogoEmAndamento = false; // Define o jogo como não em andamento
            modal.style.display = "block"; // Mostra o modal
            // Mostra a matriz atualizada no console
        }

        function baixarRelatorio() {
            // Adicione o nome do agente ao relatório
            var reportContent = `Relatório do Jogo\nNome do Agente: ${agentName}\n`;
            const {
                jsPDF
            } = window.jspdf;
            const doc = new jsPDF();

            // Definir o título do agente com base na seleção
            let agentTitle = '';
            if (selectedAgent === 'V2') {
                agentTitle = 'Agente Iniciante';
            } else if (selectedAgent === 'V3') {
                agentTitle = 'Agente Intermediário';
            } else if (selectedAgent === 'V4') {
                agentTitle = 'Agente Avançado';
            }

            // Definir respostas com base nos valores das variáveis
            let resposta1 = (matouMonstro == 1) ? 'Sim' : 'Não';
            let resposta2 = (caiuEmPoco == 1) ? 'Sim' : 'Não';
            let resposta3 = (MortoPorMonstro == 1) ? 'Sim' : 'Não';

            // Dados da tabela
            const columns = [
                "Quantidades de Passos",
                "Número de Flechas Gastas",
                "Matou o Monstro",
                "Caiu em Poço",
                "Número de Ouros Pegos",
                "Tamanho do Tabuleiro",
                "Morto Por Monstro",
                "Quantidade Monstro abatido"
            ];
            const data = [
                [passosDados, flechasGastas, resposta1, resposta2, ourosPegos, tamanhoTabuleiro, resposta3, QuantMonstroKill]
            ];

            // Adicionar título e dados ao PDF
            doc.setFontSize(18);
            doc.setTextColor(0, 0, 0);
            doc.text(`Relatório do Jogo - Nome do Agente: ${agentName}`, 10, 20); // Atualizar título para incluir o nome do agente
            doc.autoTable(columns, data, {
                startY: 30,
                styles: {
                    fontSize: 12,
                    textColor: [0, 0, 0],
                    fontStyle: 'normal',
                    cellPadding: 5
                },
                headStyles: {
                    fillColor: [200, 200, 200],
                    textColor: [0, 0, 0],
                    fontStyle: 'bold'
                },
                columnStyles: {
                    2: {
                        cellWidth: 'auto'
                    }, // Ajustar a largura da coluna "Matou o Monstro"
                    3: {
                        cellWidth: 'auto'
                    } // Ajustar a largura da coluna "Caiu em Poço"
                },
                margin: {
                    top: 30
                },





            });

            doc.save('relatorio_agente.pdf');
        }
    </script>
</body>

</html>

</script>
</body>

</html>
</script>
</body>

</html>

</script>
</body>

</html>

</html>